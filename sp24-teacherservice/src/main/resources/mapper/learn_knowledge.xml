<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="learn_knowledge">


    <sql id="sql_where">
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
        <if test="null!=Title  and ''!= Title">
            and a.Title = #{Title}
        </if>
        <if test="null!=Description  and ''!= Description">
            and a.Description = #{Description}
        </if>
        <if test="null!=path  and ''!= path">
            and a.path = #{path}
        </if>
        <if test="null!=DetailData  and ''!= DetailData">
            and a.DetailData = #{DetailData}
        </if>
        <if test="null!=Knowledgeclass  and ''!= Knowledgeclass">
            and a.Knowledgeclass = #{Knowledgeclass}
        </if>

        <if test="null!=DataType  and ''!= DataType">
            and a.DataType = #{DataType}
        </if>
        <if test="null!=pid  and ''!= pid">
            and a.pid = #{pid}
        </if>

        <if test="null!=Attachsql  and ''!= Attachsql">
            and ${Attachsql}
        </if>


    </sql>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE learn_knowledge set is_delete = 'Y' WHERE id = #{id}
    </delete>


    <!-- 删除 -->
    <delete id="deleteTrueInfo" parameterType="map">
        DELETE  a FROM  learn_knowledge a
        WHERE 1=1  <include refid="sql_where"/>
    </delete>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT a.*
        FROM learn_knowledge a
        WHERE 1=1 and a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>


    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        <if test="null!=selectField">
            #{selectField}
        </if>
        <if test="null==selectField">
            a.*
        </if>
        FROM
        learn_knowledge a
        WHERE 1=1 and a.is_delete = 'N'
        <include refid="sql_where"/>
        ORDER BY
        <if test="null!=orderby">
            #{orderby},
        </if>
        a.id asc
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>


    <!-- 查询 -->
    <select id="queryHotList" parameterType="map" resultType="dto">
        select a.*,b.*  from (select WhichFuntionID,count(WhichFuntionID) as descOrderByCount from invest_visit_path
        where FuntionType='learnKnowledge' and WhichFuntionID>0  group by WhichFuntionID
        order by descOrderByCount desc
        ) a
        left JOIN learn_knowledge b
        on a.WhichFuntionID=b.id
        where DataType not in ('folder')
        <if test="null!=start">
            limit ${start},${end}
        </if>
    </select>
    <!-- 查询 -->
    <select id="queryHotListCount" parameterType="map" resultType="dto">
        select count(a.WhichFuntionID) as total  from (select WhichFuntionID,count(WhichFuntionID) as descOrderByCount from invest_visit_path
        where FuntionType='learnKnowledge' and WhichFuntionID>0  group by WhichFuntionID
        order by descOrderByCount desc
        ) a
        left JOIN learn_knowledge b
        on a.WhichFuntionID=b.id
        where DataType not in ('folder')
    </select>

    <!-- 查询 -->
    <select id="queryClassList" parameterType="map" resultType="dto">
        SELECT * from (SELECT * FROM learn_knowledge where pid=#{pid} and ${AttachDataTypesql}
        UNION
        SELECT * FROM learn_knowledge where pid in (SELECT id FROM learn_knowledge where pid=#{pid} and DataType in ('folder')) and ${AttachDataTypesql}
        ) b
        <if test="null!=start">
            limit ${start},${end}
        </if>

    </select>

    <select id="queryClassListCount" parameterType="map" resultType="dto">
        select count(c.id) as total  from( SELECT id from (SELECT id FROM learn_knowledge where pid=#{pid} and ${AttachDataTypesql}
        UNION
        SELECT id FROM learn_knowledge where pid in (SELECT id FROM learn_knowledge where pid=#{pid} and DataType in ('folder')) and ${AttachDataTypesql}
        ) b
        ) c

    </select>


    <!-- 查询 -->
    <select id="queryLikeList" parameterType="map" resultType="dto">
        SELECT * FROM learn_knowledge where ${AttachDataTypesql}
        <if test="null!=start">
            limit ${start},${end}
        </if>

    </select>

    <select id="queryLikeListCount" parameterType="map" resultType="dto">
        SELECT count(id) as total FROM learn_knowledge  where ${AttachDataTypesql}
    </select>

    <!-- 查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        count(a.id) as total
        FROM learn_knowledge a
        WHERE 1=1 and a.is_delete = 'N'

        <include refid="sql_where"/>
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        INSERT INTO learn_knowledge
        (
        <if test="id!=null and ''!=id">
            id,
        </if>
        <if test="Title!=null and ''!=Title">
            Title,
        </if>
        <if test="Pic!=null and ''!=Pic">
            Pic,
        </if>
        <if test="Description!=null and ''!=Description">
            Description,
        </if>
        <if test="path!=null and ''!=path">
            path,
        </if>
        <if test="DetailData!=null and ''!=DetailData">
            DetailData,
        </if>
        <if test="Sort!=null and ''!=Sort">
            Sort,
        </if>
        <if test="Knowledgeclass!=null and ''!=Knowledgeclass">
            Knowledgeclass,
        </if>
        <if test="DataType!=null and ''!=DataType">
            DataType,
        </if>
        <if test="pid!=null and ''!=pid">
            pid,
        </if>


        <if test="creator!=null and ''!=creator">
            creator,
        </if>
        create_time,
        is_delete
        )
        VALUES
        (
        <if test="id!=null and ''!=id">
            #{id},
        </if>
        <if test="Title!=null and ''!=Title">
            #{Title},
        </if>
        <if test="Pic!=null and ''!=Pic">
            #{Pic},
        </if>
        <if test="Description!=null and ''!=Description">
            #{Description},
        </if>
        <if test="path!=null and ''!=path">
            #{path},
        </if>
        <if test="DetailData!=null and ''!=DetailData">
            #{DetailData},
        </if>
        <if test="Sort!=null and ''!=Sort">
            #{Sort},
        </if>


        <if test="Knowledgeclass!=null and ''!=Knowledgeclass">
            #{Knowledgeclass},
        </if>
        <if test="DataType!=null and ''!=DataType">
            #{DataType},
        </if>
        <if test="Knowledgeclass!=null and ''!=Knowledgeclass">
            #{Knowledgeclass},
        </if>
        <if test="pid!=null and ''!=pid">
            #{pid},
        </if>

        <if test="creator!=null and ''!=creator">
            #{creator},
        </if>

        now(),
        'N')
        <selectKey resultType="java.lang.Long" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>


    </insert>


    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update learn_knowledge
        set
        <if test="null!=id  and ''!= id">
            id = #{id},
        </if>
        <if test="null!=Title  and ''!= Title">
            Title = #{Title},
        </if>
        <if test="null!=Pic  and ''!= Pic">
            Pic = #{Pic},
        </if>
        <if test="null!=Description  and ''!= Description">
            Description = #{Description},
        </if>
        <if test="null!=path  and ''!= path">
            path = #{path},
        </if>
        <if test="null!=DetailData  and ''!= DetailData">
            DetailData = #{DetailData},
        </if>
        <if test="null!=Sort  and ''!= Sort">
            Sort = #{Sort},
        </if>

        <if test="null!=Knowledgeclass  and ''!= Knowledgeclass">
            Knowledgeclass = #{Knowledgeclass},
        </if>
        <if test="null!=DataType  and ''!= DataType">
            DataType = #{DataType},
        </if>

        <if test="null!=pid  and ''!= pid">
            pid = #{pid},
        </if>


        <if test="null!=creator  and ''!= creator">
            creator = #{creator},
        </if>


        update_time = now(),
        updator = #{updator}
        where id = #{id}
    </update>


</mapper>
